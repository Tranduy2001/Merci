"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6582],{86981:function(e,t,n){n.d(t,{Z:function(){return i}});function i(e,t,n,i){let l=Math.max(Math.min(i,(n-1)/2),0),a=e-l,r=a<0?n+a:a,s=(e+l)%n;return r<s&&t>=r&&t<=s||r>=s&&(t>=r||t<=s)}},66582:function(e,t,n){n.d(t,{t:function(){return ev},_i:function(){return ez},io:function(){return eR}});var i=n(24246),l=n(27378),a=n(59686),r=n(67188),s=n(17572),o=n(19303),d=n(46063),c=n(84174),h=n(774),u=n(7025),x=n(2912),g=n(46413),p=n(72352),m=n(60126),f=n(76334),j=n(90281),b=n(86677),w=n(38541),y=n(56552),v=n(5148),k=n(27693),S=n.n(k),C=n(79894),z=n.n(C),I=n(66230),E=n(27114),M=n(81645),D=n(86144),W=n(92015),R=n(95537);function A(){let e=(0,l.useCallback)(async e=>{let{templateId:t,analyticsEvent:n}=e;await (0,R.FY)({analyticsEvent:n,templateId:t,downloadFunc:async()=>null})},[]);return e}let F=(0,v.m)("div",{baseStyle:{position:"absolute",backgroundColor:"white",width:"100px",height:"100px",rounded:6,borderColor:"gray.300",borderWidth:"1px",borderStyle:"solid",shadow:"md"}}),O=e=>{let{isMobile:t}=e;return(0,i.jsxs)(s.k,{alignSelf:t?"flex-start":"center",alignItems:"center",gap:1,bgColor:"gray.200",borderRadius:"20px",py:1,px:2,children:[(0,i.jsx)(E.Pz,{color:"#768089",fontSize:"xs"}),(0,i.jsx)(h.xu,{fontSize:"x-small",fontWeight:"bold",color:"#768089",children:"Downloaded"})]})},_=e=>{let{batch:t,onClick:n}=e,l=e=>{let{children:t}=e;return(0,i.jsxs)(s.k,{flexDir:"row",alignItems:"center",gap:2,children:[(0,i.jsx)(E.zM,{color:"#fcc017"}),t]})};return"failed"===t.state?(0,i.jsx)(l,{children:(0,i.jsx)(u.x,{fontSize:"x-small",children:"Batch couldn't be processed."})}):t.failedTaskCount&&0!==t.failedTaskCount?(0,i.jsxs)(s.k,{flexDir:"row",alignItems:"center",gap:2,children:[(0,i.jsx)(E.zM,{color:"#fcc017"}),(0,i.jsxs)(g.z,{variant:"unstyled",height:"auto",fontSize:"x-small",fontWeight:"normal",textDecoration:"underline",onClick:n,children:[t.failedTaskCount," file",t.failedTaskCount>1?"s":""," could not be processed"]})]}):(0,i.jsx)(h.xu,{})},U=e=>{var t;let{batch:n,thumbnailContainerWidth:a,isMobile:r=!1,onThumbnailWidthChange:o}=e,[d,g]=(0,l.useState)(1),[p,m]=(0,l.useState)(!1),j=30-S()().diff(S()(n.createdAt),"day"),b=(0,l.useRef)(),w=A(),y=(0,W.Z)(async()=>{let e=await (0,D.nO)().get("/api/batches/".concat(n.id,"/tasks?state=failed"));return e.data.data.tasks},[n.id]),v=(0,l.useCallback)(async()=>{n.designId&&await w({templateId:n.designId,analyticsEvent:{name:"download_from_batch_overview",category:"batch_processing"}})},[w,n.designId]),k=(0,c.S)({base:{width:50,height:50},sm:{width:60,height:60},lg:{width:70,height:70}}),C=(0,l.useMemo)(()=>(b.current||(b.current=n.thumbnailUrl),b.current),[n]),R=(0,l.useMemo)(()=>k?{width:k.width*d,height:k.height}:{width:50,height:50},[d,k]),U=(0,l.useMemo)(()=>({path:"/animations/loading.json"}),[]);function Z(){m(!0)}return(0,l.useEffect)(()=>{o(n.id,R.width)},[n.id,R.width,o]),(0,i.jsxs)(I.M2,{condition:r,wrapper:e=>(0,i.jsxs)(s.k,{flexDir:"column",children:[e,"processing"!==n.state&&(0,i.jsxs)(s.k,{flexDir:"row",justifyContent:"space-between",px:4,pt:2,pb:0,children:[(0,i.jsx)(_,{batch:n,onClick:Z}),(0,i.jsxs)(u.x,{color:"gray.500",fontSize:"x-small",children:["Batch will be deleted in ",j," days."]})]})]}),children:[(0,i.jsxs)(P,{flexDir:"row",p:4,gap:{base:3,lg:8},children:[(0,i.jsx)(s.k,{mt:{base:4,lg:6},mr:{base:4,lg:6},width:null!=a?a:210,justifyContent:"center",children:(0,i.jsxs)(h.xu,{position:"relative",children:[(0,i.jsx)(F,{...(0,M.Z)(R),top:{base:-4,lg:-6},right:{base:-4,lg:-6}}),(0,i.jsx)(F,{...(0,M.Z)(R),top:{base:-2,lg:-3},right:{base:-2,lg:-3}}),(0,i.jsx)(f.E,{position:"relative",...(0,M.Z)(R),maxWidth:"none",objectFit:"cover",rounded:6,borderColor:"gray.300",borderWidth:"1px",borderStyle:"solid",src:null!=C?C:void 0,alt:"Original image",onLoad:function(e){g(e.currentTarget.width/e.currentTarget.height)},fallback:(0,i.jsx)(F,{position:"relative",...(0,M.Z)(R),children:"processing"===n.state&&(0,i.jsx)(I.qf,{options:U,...(0,M.Z)(R)})})})]})}),(0,i.jsxs)(s.k,{flexDir:"column",flexGrow:1,gap:1,children:[(0,i.jsxs)(h.xu,{fontSize:"x-small",children:[S()(n.createdAt).format("dddd, MMMM DD, hh:mm a")," |"," ",n.taskCount," files"]}),(0,i.jsx)(h.xu,{fontSize:{base:"sm",sm:"md",lg:"xl"},children:n.name}),"processing"!==n.state&&!r&&(0,i.jsx)(_,{batch:n,onClick:Z}),n.downloadedAt&&r&&(0,i.jsx)(O,{isMobile:r})]}),(0,i.jsxs)(s.k,{gap:2,children:[n.downloadedAt&&!r&&(0,i.jsx)(O,{isMobile:r}),(0,i.jsxs)(s.k,{flexDir:"column",alignItems:"flex-end",gap:2,children:["processing"!==n.state&&!r&&(0,i.jsx)(u.x,{fontSize:"x-small",children:"\xa0"}),"processing"===n.state&&(r?(0,i.jsx)(z(),{href:"/batch/".concat(n.id),passHref:!0,legacyBehavior:!0,children:(0,i.jsx)(x.r,{children:(0,i.jsx)(E.LH,{fontSize:"24px",color:"palette.2"})})}):(0,i.jsx)(I.Qj,{href:"/batch/".concat(n.id),inverted:!0,children:"Show details"})),"processed"===n.state&&n.downloadUrl&&(r?(0,i.jsx)(z(),{href:n.downloadUrl,passHref:!0,legacyBehavior:!0,children:(0,i.jsx)(x.r,{onClick:v,children:(0,i.jsx)(E._8,{fontSize:"24px",color:"palette.2"})})}):(0,i.jsx)(I.Qj,{href:n.downloadUrl,inverted:!0,onClick:v,children:"Download .zip"})),"failed"===n.state&&!r&&(0,i.jsx)(I.Qj,{href:"",disabled:!0,children:"Download .zip"}),"processing"!==n.state&&!r&&(0,i.jsxs)(u.x,{color:"gray.500",fontSize:"x-small",children:["Batch will be deleted in ",j," days."]})]})]})]}),!y.loading&&y.value&&(0,i.jsx)(I.oF,{open:p,onClose:function(){m(!1)},errors:y.value.map(e=>({fileName:e.originalImageName,msg:null!==(t=e.errorMessage)&&void 0!==t?t:""}))})]})},Z=e=>{var t;let{batch:n}=e,[a,r]=(0,l.useState)(!1),d=Boolean(n.archivedAt),c=30-S()().diff(S()(n.createdAt),"day"),h=A(),x=(0,W.Z)(async()=>{let e=await (0,D.nO)().get("/api/batches/".concat(n.id,"/tasks?state=failed"));return e.data.data.tasks},[n.id]),p=(0,l.useCallback)(async()=>{n.designId&&await h({templateId:n.designId,analyticsEvent:{name:"download_from_batch_overview",category:"batch_processing"}})},[h,n.designId]);return(0,i.jsxs)(s.k,{flexDir:"column",alignItems:"center",children:[d?(0,i.jsx)(E.QW,{color:"palette.3",fontSize:"60px"}):(0,i.jsx)(E.Pz,{color:"#00E3A0",fontSize:"60px"}),(0,i.jsx)(o.X,{maxWidth:"500px",lineHeight:{base:"40px",md:"52px"},textAlign:"center",my:7,children:d?"Download expired":"Your designs are ready to download"}),!d&&(0,i.jsxs)(s.k,{gap:5,flexDir:"column",alignItems:"center",children:[n.downloadUrl&&(0,i.jsx)(I.Qj,{href:n.downloadUrl,onClick:p,children:"Download .zip"}),!!n.failedTaskCount&&n.failedTaskCount>0&&(0,i.jsxs)(s.k,{flexDir:"row",alignItems:"center",gap:2,children:[(0,i.jsx)(E.zM,{color:"#fcc017"}),(0,i.jsxs)(g.z,{variant:"unstyled",height:"auto",fontSize:"xs",fontWeight:"normal",textDecoration:"underline",onClick:function(){r(!0)},children:[n.failedTaskCount," file",n.failedTaskCount>1?"s":""," could not be processed"]})]}),(0,i.jsxs)(u.x,{fontSize:"xs",children:["Batch will be deleted in ",c," days"]})]}),!x.loading&&x.value&&(0,i.jsx)(I.oF,{open:a,onClose:function(){r(!1)},errors:x.value.map(e=>({fileName:e.originalImageName,msg:null!==(t=e.errorMessage)&&void 0!==t?t:""}))})]})},T=e=>{let{children:t,...n}=e;return(0,i.jsx)(s.k,{flexDir:"column",width:"100%",alignItems:"center",backgroundColor:"white",borderRadius:5,gap:10,p:8,...n,children:t})};var P=T,N=n(93412),B=n(44833),L=n(99830);let Q=e=>{let{files:t,previewElements:n,numberOfPreviewImages:a,thumbnailSize:r,onFilesChange:d}=e,[c,x]=(0,l.useState)(!1),[p,m]=(0,l.useState)([]),[j,b]=(0,l.useState)(!1);(0,l.useEffect)(()=>{p.length>0&&x(!0)},[p]);let w=(0,l.useCallback)(e=>{let i,l;function r(e){return{file:e,objectURL:URL.createObjectURL(e)}}if(n.length<a){let s=a-n.length,o=s>e.length?e:e.slice(0,s),d=o.map(r);l=[...n,...d],i=[...t,...e]}else{let s=e.slice(0,Math.min(e.length,a)),o=s.map(r);l=[...o,...n].slice(0,a),i=[...e,...t];for(let e=a-o.length;e<a;e++)URL.revokeObjectURL(n[e].objectURL)}d(i,l)},[t,a,d,n]),{getRootProps:y,getInputProps:v,isDragActive:k,open:S}=(0,B.uI)({onDrop:w,getFilesFromEvent:async e=>{b(!0);let{validFiles:t,inValidFiles:n}=await (0,L.i)(e);return b(!1),m(n),t},useFsAccessApi:!1,accept:{"image/*":[".png",".jpeg",".jpg"]},noClick:!0,noKeyboard:!0});return(0,i.jsxs)(h.xu,{position:"relative",...y(),children:[(0,i.jsx)("input",{...v()}),j&&(0,i.jsx)(I.cF,{children:(0,i.jsxs)(s.k,{flexDir:"column",alignItems:"center",color:"white",children:[(0,i.jsx)(N.$,{thickness:"4px",size:"xl",mb:8}),(0,i.jsx)(o.X,{size:"md",mb:4,children:"Adding images..."})]})}),(0,i.jsxs)(s.k,{flex:1,flexDir:"column",justifyContent:"center",py:t.length>0?0:32,children:[(0,i.jsx)(g.z,{_hover:{background:t.length>0?"white":"palette.2"},_active:{background:t.length>0?"white":"palette.2"},color:t.length>0?"palette.2":"white",fontSize:"xl",fontWeight:"bold",background:t.length>0?"white":"palette.2",borderWidth:"1px",borderColor:t.length>0?"palette.2":"white",height:"auto",py:2,px:8,mb:2,mx:"auto",leftIcon:(0,i.jsx)(E.rG,{fontSize:"2rem"}),onClick:S,children:"Select Images"}),(0,i.jsx)(u.x,{fontSize:"md",textAlign:"center",color:"gray.900",display:{base:"none",lg:"block"},children:"or drop files and folders"})]}),t.length>0&&(0,i.jsxs)(s.k,{wrap:"wrap",mt:6,pt:6,gap:6,children:[n.map((e,t)=>(0,i.jsx)(f.E,{height:(0,M.Z)(r).height,alt:"",src:e.objectURL},t)),t.length-n.length>0&&(0,i.jsx)(s.k,{...(0,M.Z)(r),justifyContent:"center",alignItems:"center",textAlign:"center",bgColor:"#F7F7F7",children:(0,i.jsxs)(u.x,{fontSize:"sm",children:["+ ",t.length-n.length," more"]})})]}),k&&(0,i.jsx)(s.k,{position:"absolute",width:"100%",height:"100%",top:0,left:0,justifyContent:"center",alignItems:"center",backgroundColor:"white",borderRadius:5,borderWidth:10,borderStyle:"dashed",borderColor:"palette.2",children:(0,i.jsxs)(h.xu,{textAlign:"center",children:[(0,i.jsx)(o.X,{size:"2xl",mb:4,children:"Drop images here"}),(0,i.jsx)(u.x,{fontWeight:"600",children:"(supported types are jpg and png)"})]})}),(0,i.jsx)(I.oF,{open:c,onClose:function(){x(!1),m([])},errors:p.map(e=>({fileName:e.file.name,msg:e.error.message})),header:"".concat(p.length," image").concat(p.length>1?"s":""," could not be selected"),footer:"OK"})]})};var H=n(14808);let X=e=>{let{step:t,progress:n,action:l}=e;return(0,i.jsxs)(s.k,{flexDir:"column",width:"100%",maxWidth:"600px",gap:2,children:[(0,i.jsx)(H.E,{value:n,width:"100%",bgColor:"gray.200",borderRadius:20}),(0,i.jsxs)(u.x,{fontSize:"sm",children:[(0,i.jsxs)(h.xu,{as:"span",fontWeight:"bold",children:["Step ",t," of 2:"]})," ",l,"... ",n,"%"]})]})},Y=e=>{let{uploads:t,selectedTemplate:n,numberOfRemainingImages:a,thumbnailSize:r}=e,o=(0,l.useMemo)(()=>({width:r.width*n.aspectRatio,height:r.height}),[n.aspectRatio,r.height,r.width]);return(0,i.jsxs)(s.k,{flexWrap:"wrap",gap:6,children:[t.map((e,t)=>e&&100===e.progress&&e.imageId?(0,i.jsx)(er,{templateId:n.id,imageId:e.imageId,placeholderCanvasSize:o},t):(0,i.jsx)(j.O,{...(0,M.Z)(o)},t)),a>0&&(0,i.jsx)(s.k,{justifyContent:"center",alignItems:"center",textAlign:"center",bgColor:"#F7F7F7",...(0,M.Z)(o),children:(0,i.jsxs)(u.x,{fontSize:"sm",children:["+ ",a," more"]})})]})};var q=n(388),G=n(10043),K=n(87228),$=n(54837);n(29676);var J=n(19159),V=n(34412),ee=n.n(V),et=n(86981);function en(){let e=(0,q.Z)(["\n            .carousel-root {\n              width: 100%;\n              flex-grow: 1;\n            }\n\n            .carousel .slide {\n              display: flex;\n              justify-content: center;\n              background: none;\n            }\n          "]);return en=function(){return e},e}let ei=(0,v.m)(g.z,{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",position:"absolute",fontSize:{base:"24px",md:"48",lg:"60px"},zIndex:5,color:"gray.400"}}),el=e=>{var t;let{imageId:n,selectedTemplateId:a,thumbnailSize:r,loadFromCache:o=!0,onTemplateSelect:d}=e,[c,u]=(0,l.useState)(0),[x,p]=(0,l.useState)(0),{ref:m,width:f=1}=ee()(),{data:b=[]}=(0,y.useQuery)(["user/templates",n],async()=>{let e=w.Z.stringifyUrl({url:"/api/user/templates",query:{"image-id":n}},{skipNull:!0}),t=await (0,D.nO)().get(e),[i]=t.data.data;return i},{refetchOnMount:!o}),{data:v=[]}=(0,y.useQuery)(["categories",n],async()=>{let e=w.Z.stringifyUrl({url:"/gallery",query:{"image-id":n}},{skipNull:!0}),t=await (0,D.JQ)().get(e),i=t.data.data;return i},{refetchOnMount:!o}),k=(0,l.useMemo)(()=>{let e=[];return b.length>0&&e.push({id:null,name:"My designs",templates:(0,J.pj)(b),description:""}),v.length>0&&e.push(...v),e},[v,b]),S=(0,l.useMemo)(()=>1===f?[]:k.map((e,t)=>(function(e){let t=k[e],n=[[]];return t.templates.reduce((e,t)=>{let i={width:r.width*t.aspectRatio,height:r.height},l=i.width+16;if(l>f){let e=l-f,t=e/i.width;i.width=i.width*(1-t),i.height=i.height*(1-t),l=i.width+16}return e+l>f?(e=l,n.push([{canvasSize:i,...t}])):(e+=l,n[n.length-1].push({canvasSize:i,...t})),e},0),n})(t)),[r,k,f]),C=(0,l.useCallback)(e=>e.findIndex(e=>e.find(e=>e.id===a)),[a]);function z(e){d(e)}return(0,l.useEffect)(()=>{a&&S.some((e,t)=>{let n=C(e);return n>-1&&(u(t),p(n),!0)})},[S,C,a]),(0,i.jsxs)(h.xu,{children:[(0,i.jsx)(s.k,{columnGap:8,rowGap:4,justifyContent:"center",flexWrap:"wrap",children:k.map((e,n)=>(0,i.jsx)(g.z,{variant:"unstyled",p:0,height:"auto",minHeight:"auto",color:c===n?"palette.2":"gray.900",fontSize:"xs",fontWeight:c===n?"bold":"normal",borderRadius:0,borderBottomWidth:c===n?3:0,borderColor:"palette.2",onClick:()=>(function(e){let t=C(S[e]);p(t>-1?t:0),u(e)})(n),children:e.name},null!==(t=e.id)&&void 0!==t?t:n))}),(0,i.jsxs)(h.xu,{flex:"1",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",mt:6,mb:4,px:{base:4,md:12,lg:16},overflow:"hidden",children:[(0,i.jsx)(G.xB,{styles:(0,G.iv)(en())}),S[c]&&S[c].length>1&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ei,{variant:"unstyled",left:{base:"-12px",md:"-4px",lg:0},onClick:function(){p(x-1)},children:(0,i.jsx)(K.bUI,{})}),(0,i.jsx)(ei,{variant:"unstyled",right:{base:"-12px",md:"-4px",lg:0},onClick:function(){p(x+1)},children:(0,i.jsx)(K.Dli,{})})]}),(0,i.jsx)(h.xu,{ref:m,display:"flex",flexDirection:"column",width:"100%",children:(0,i.jsx)($.lr,{infiniteLoop:!0,autoPlay:!1,showStatus:!1,showIndicators:!1,showThumbs:!1,showArrows:!1,selectedItem:x,onChange:function(e){p(e)},children:S[c]&&S[c].map((e,t)=>(0,et.Z)(x,t,S[c].length,3)?(0,i.jsx)(h.xu,{display:"flex",flexDir:"row",justifyContent:"center",alignItems:"flex-end",gap:"".concat(16,"px"),children:e.map(e=>n?(0,i.jsx)(er,{name:e.name,templateId:e.id,imageId:n,placeholderCanvasSize:e.canvasSize,isSelected:a===e.id,onSelect:z},e.id):(0,i.jsx)(j.O,{...(0,M.Z)(e.canvasSize)},e.id))},t):(0,i.jsx)(h.xu,{},t))})})]})]})},ea=e=>{let{name:t,templateId:n,imageId:a,placeholderCanvasSize:r,isSelected:o,onSelect:d,...c}=e,{isLoading:x,data:g}=(0,y.useQuery)(["template",n,a,!0],async()=>{let e=w.Z.stringify({"image-id":a,res:"thumbnail"},{skipNull:!0}),t=await (0,D.nO)().get("/api/templates/".concat(n,"?").concat(e));return t.data.data.template}),p=(0,l.useMemo)(()=>!x&&(null==g?void 0:g.aspectRatio)?{height:r.height,width:g.aspectRatio*r.height}:r,[r,x,null==g?void 0:g.aspectRatio]);return(0,i.jsxs)(s.k,{_hover:{cursor:d?"pointer":"default"},flexDir:"column",position:"relative",onClick:function(){d&&g&&d(g.id)},...c,children:[(0,i.jsx)(I.YS,{transition:"box-shadow .1s linear",loading:x,template:g,canvasSize:p}),o&&(0,i.jsx)(h.xu,{position:"absolute",top:0,left:0,...(0,M.Z)(p),borderWidth:o?3:0,borderColor:"palette.2"}),t&&(0,i.jsx)(u.x,{noOfLines:1,width:(0,M.Z)(p).width,height:{base:"14px",lg:"16px"},fontSize:{base:"xx-small",lg:"xs"},color:"gray.500",textAlign:"left",children:t})]})};var er=ea,es=n(56477),eo=n(2509),ed=n(36520),ec=n(32312);let eh=e=>{let{items:t}=e;return(0,i.jsx)(es.a,{fontSize:"x-small",spacing:1,separator:(0,i.jsx)(ec.jZo,{color:"gray.500"}),children:t.map((e,t)=>(0,i.jsx)(eo.g,{...e.styles,children:(0,i.jsx)(ed.A,{href:e.link,as:z(),children:e.text})},t))})};var eu=n(8408),ex=n(52853),eg=n(6400),ep=n(44579),em=n(60521),ef=n(55840);let ej=n(3284),eb=e=>{let{index:t,currentStep:n,title:l,disabled:c,inActiveNode:h,children:u}=e;return(0,i.jsx)(a.Q,{display:t>n?"none":"block",bgColor:"white",border:0,borderRadius:5,mb:6,children:e=>{let{isExpanded:n}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.K,{_hover:{bgColor:"white",cursor:n||c?"default":"cursor"},px:6,pr:n?6:2,py:2,children:(0,i.jsxs)(s.k,{width:"100%",height:"40px",justifyContent:"space-between",alignItems:"center",color:c?"gray.500":"gray.900",gap:2,children:[(0,i.jsxs)(o.X,{as:"h2",fontSize:16,lineHeight:"16px",textAlign:"left",whiteSpace:"nowrap",children:[t+1,". ",l]}),!n&&h]})}),(0,i.jsx)(d.H,{p:6,children:u})]})}})},ew=[{text:"Batch Editor",link:"/batch",styles:{fontWeight:"bold"}},{text:"New Batch",link:"/batch/new"}],ey=e=>{var t,n,a,r,o,d,v;let{initialBatch:k,onBatchCreated:C}=e,z=(0,b.useRouter)(),{designId:E}=z.query,{batchEditorStore:W}=(0,eu.oR)(),R=(0,y.useQueryClient)(),A=(0,ex.s$)(),[F,O]=(0,l.useState)(null!=k?k:null),[_,U]=(0,l.useState)(null),[T,N]=(0,l.useState)(k?eN(k):ew),[B,L]=(0,l.useState)(k?3:0),[H,q]=(0,l.useState)([0]),[G,K]=(0,l.useState)([]),[$,J]=(0,l.useState)([]),[V,ee]=(0,l.useState)(null),[et,en]=(0,l.useState)(null),[ei,ea]=(0,l.useState)(null!==(n=Boolean(k))&&void 0!==n&&n),[es,eo]=(0,l.useState)(0),ed=(0,l.useRef)([]),[ec,ey]=(0,l.useState)(ed.current),{uploadImage:ev}=(0,ex.fr)({}),ek={_hover:{cursor:ei?"default":"pointer"},filter:"opacity(".concat(ei?.5:1,")")},[eS,eC]=(0,l.useState)(!1),[ez,eI]=(0,l.useState)([]),eE=(0,l.useRef)(!0),eM=(0,c.S)({base:!0,md:!1}),eD=(0,l.useMemo)(()=>({base:{width:100,height:100},md:{width:120,height:120},lg:{width:135,height:135}}),[]),eW=(0,c.S)({base:eD.base,md:eD.md,lg:eD.lg}),eR=[{text:"Next",disabled:!V||G.length<=0||G.length>V,onClick:async()=>await eQ([$[0].file])},{text:"Next",disabled:!et,onClick:()=>eQ($.map(e=>e.file))},{text:"Process ".concat(G.length," files"),disabled:!1,onClick:()=>et&&eH(G,$,et)}];(0,ef.x)(e=>{F&&"pending"===F.state&&e.preventDefault()});let eA=(0,l.useMemo)(()=>{var e;return null!==(a=null===(e=ec[0])||void 0===e?void 0:e.imageId)&&void 0!==a?a:null},[ec]),eF=(0,l.useMemo)(()=>({path:"/animations/loading.json"}),[]),eO=(0,l.useMemo)(()=>{let e=[];if($.length>0)e.push(...$.map(e=>({original:e.objectURL})));else for(let t=0;t<5;t++)if(ez[t]){let{thumbnailUrl:n,designThumbnailUrl:i}=ez[t];e.push({original:n,design:i})}return eM?e[0]?[e[0]]:[]:e},[eM,$,ez]),e_=(0,l.useMemo)(()=>G.length>0?G.length:(null==F?void 0:F.taskCount)?F.taskCount:0,[null==F?void 0:F.taskCount,G.length]),eU=(0,l.useCallback)(async(e,t)=>{let n=R.getQueryData(["template",e,t,!0]);if(n)return n;let i=w.Z.stringify({"image-id":t,res:"thumbnail"},{skipNull:!0}),l=await A((0,D.nO)().get("/api/templates/".concat(e,"?").concat(i)),{skipErrorHandling:(e,t)=>(null==t?void 0:t.code)==="TEMPLATE_NOT_FOUND"});if((null==l?void 0:l.apiErrors)&&"TEMPLATE_NOT_FOUND"===l.apiErrors[0].code)return null;let a=l.data.data.template;return a?(R.setQueryData(["template",e,t,!0],a),a):null},[A,R]),eZ=(0,l.useCallback)(async e=>{var t;let n=await A((0,D.nO)().get("/api/batches/".concat(e,"/tasks")),{skipErrorHandling:()=>!0});return null!==(t=n.data.data.tasks)&&void 0!==t?t:null},[A]),eT=(0,l.useCallback)(async(e,t)=>{let n=await e();n&&eE.current&&t(n)},[]);async function eP(){try{let e=await (0,D.nO)().get("/api/batches"),t=e.data.data.batches;if(-1!==t.findIndex(e=>"processing"===e.state)){eC(!0);return}eC(!1)}catch(e){eC(!0);return}z.replace("/batch/new",void 0,{shallow:!0}),O(null),eI([]),ea(!1),U(null),L(0),q([]),N(ew),K([]),J([]),ee(null),en(null),ed.current=[],ey([...ed.current])}function eN(e){return[ew[0],{text:"".concat(e.name," (").concat(S()(e.createdAt).format("dddd, MMMM DD, hh:mm a"),")"),link:"/batch/".concat(e.id)}]}async function eB(e,t){let n=null;null===V?ee(n=await (0,em.r)()):n=V,(!n||e.length>n)&&eL(),K(e),J(t),en(null),ed.current=Array.from({length:Math.min(e.length,5)},()=>null),ey([...ed.current])}function eL(){U((0,i.jsxs)(h.xu,{fontSize:"sm",children:[(0,i.jsxs)(u.x,{textAlign:"center",color:"palette.3",children:["Your are exceeding the fair use limit."," ",(0,i.jsx)(x.r,{href:"mailto:support@designify.com",fontWeight:"bold",textDecoration:"underline",children:"Get in touch with support"}),"."]}),(0,i.jsxs)(u.x,{textAlign:"center",color:"palette.3",children:["If you want to reset your uploads"," ",(0,i.jsx)(g.z,{variant:"unstyled",fontSize:"sm",textDecoration:"underline",onClick:eP,children:"click here."})]})]}))}async function eQ(e){let t=await (0,em.r)();if(ee(t),!t||e.length>t){eL();return}e.forEach(async(e,t)=>{if(ed.current[t])return;ed.current[t]={progress:0,imageId:null},ey([...ed.current]);let n=await ev(e,{generateOnlyBasicImageModifiers:null!==et&&!et.dynamicAspectRatio,onUploadProgress:e=>{let n=Math.round(100*e.loaded/e.total);ed.current[t]={progress:n,imageId:null},ey([...ed.current])}});ed.current[t]={progress:100,imageId:null==n?void 0:n.data.id},ey([...ed.current])})}async function eH(e,t,n){var i,l,a,r,s;ea(!0);try{let l=await eX(n);O(l),await eY(l,e,t),await eG(l),eE.current&&(i=l.id,z.replace("/batch/".concat(i),void 0,{shallow:!0})),C(l),N(eN(l)),eK(l)}catch(t){let e=null===(l=t.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:null===(r=a.errors)||void 0===r?void 0:null===(s=r[0])||void 0===s?void 0:s.message;alert(null!=e?e:"Something went wrong!"),location.reload()}}async function eX(e){let t=await (0,D.nO)().post("/api/batches",{data:{name:e.name,designId:e.id}});return t.data.data.batch}async function eY(e,t,n){let i=Array.from({length:t.length},()=>0);eo(0);let l=setInterval(()=>{let e=i.reduce((e,t)=>e+t,0);eo(Math.round(e/t.length)),e/t.length==100&&clearInterval(l)},1e3),a=e=>({onUploadProgress(t){var n;let l=Math.round(100*t.loaded/(null!==(n=null==t?void 0:t.total)&&void 0!==n?n:100));i[e]=l}});for(let[t,i]of n.entries())await eq(e.id,i.file,a(t));let r=(0,eg.Z)(5),s=t.slice(5).map((t,n)=>r(()=>eq(e.id,t,a(n+5))));await Promise.all(s)}function eq(e,t,n){let i=new FormData;return i.append("file",t,t.name),(0,D.nO)().post("/api/batches/".concat(e,"/tasks"),i,n)}async function eG(e){await (0,D.nO)().post("/api/batches/".concat(e.id,"/process"))}async function eK(e){let t=async()=>{let t=await (0,D.nO)().get("/api/batches/".concat(e.id)),n=t.data.data.batch;return eE.current&&O(n),n};ej(t,e=>!eE.current||"processed"===e.state,3e3,1/0)}return(0,ep.Z)(async()=>{let{files:e,templateId:t,imageIds:n}=W;if(e&&n&&t){L(3);let i=await eU(t,n[0]);if(!i)return;en(i),K(e);let l=e.slice(0,5).map(e=>({file:e,objectURL:URL.createObjectURL(e)}));J(l);let a=n.map(e=>({imageId:e,progress:100}));ey(a),W.reset(),eH(e,l,i)}}),(0,l.useEffect)(()=>{async function e(){try{let e=await (0,D.nO)().get("/api/batches"),t=e.data.data.batches;if(-1!==t.findIndex(e=>"processing"===e.state)){eC(!0);return}eC(!1)}catch(e){eC(!0)}}k&&"processing"===k.state?(eK(k),eC(!1)):e()},[k]),(0,l.useEffect)(()=>(eE.current=!0,()=>{eE.current=!1}),[]),(0,l.useEffect)(()=>{if(((null==F?void 0:F.state)==="processing"||(null==F?void 0:F.state)==="processed")&&k){let e=F.designId;eT(()=>eZ(F.id),eI),e&&eT(()=>eU(e),en)}},[null==F?void 0:F.id,null==F?void 0:F.state,null==F?void 0:F.designId,k,eZ,eU,eT]),(0,l.useEffect)(()=>{E&&eA&&eT(()=>eU(E,eA),en)},[eT,eU,eA,E]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.xu,{display:{base:"none",md:"block"},pt:"100px",pl:"40px",children:(0,i.jsx)(eh,{items:T})}),(0,i.jsxs)(p.W,{maxW:"990px",pt:{base:"92px",md:"calc(172px - 115px)"},px:0,mb:8,children:[(0,i.jsxs)(m.U,{index:B,allowMultiple:!1,allowToggle:!1,onChange:function(e){ei||(L(e),q([...H,e]))},reduceMotion:!0,children:[(0,i.jsx)(eb,{index:0,currentStep:B,title:"Select Images",disabled:ei,inActiveNode:(0,i.jsx)(s.k,{gap:2,children:eO.length>0?(0,i.jsxs)(i.Fragment,{children:[eO.map((e,t)=>(0,i.jsx)(f.E,{height:"40px",alt:"",src:null!==(r=e.original)&&void 0!==r?r:void 0,...ek},t)),e_-5>0&&(0,i.jsx)(s.k,{width:"40px",height:"40px",justifyContent:"center",alignItems:"center",bgColor:"#F7F7F7",children:(0,i.jsxs)(u.x,{fontSize:"sm",children:["+",e_-eO.length]})})]}):(0,i.jsx)(u.x,{fontSize:"sm",children:"Loading..."})}),children:eW&&(0,i.jsx)(Q,{files:G,previewElements:$,numberOfPreviewImages:5,thumbnailSize:eW,onFilesChange:eB})}),(0,i.jsx)(eb,{index:1,currentStep:B,title:"Select Design",disabled:ei,inActiveNode:(0,i.jsxs)(s.k,{flex:1,gap:2,minWidth:0,height:"40px",alignItems:"center",justifyContent:"flex-end",children:[et&&(0,i.jsx)(u.x,{fontSize:"sm",noOfLines:1,children:et.name}),et&&eA?(0,i.jsx)(I.YS,{template:et,canvasSize:{width:40*et.aspectRatio,height:40},...ek}):F&&F.thumbnailUrl?(0,i.jsx)(f.E,{height:"40px",alt:"",src:F.thumbnailUrl,...ek}):(0,i.jsx)(j.O,{...(0,M.Z)({width:40*(null!==(o=null==et?void 0:et.aspectRatio)&&void 0!==o?o:1),height:40})})]}),children:eW&&(0,i.jsx)(el,{imageId:eA,selectedTemplateId:E||null,thumbnailSize:eW,loadFromCache:H.slice(0,-1).includes(1),onTemplateSelect:function(e){!function(e){let{url:t,query:n}=w.Z.parseUrl(window.location.href),i=w.Z.stringifyUrl({url:t,query:{...n,designId:e}});z.replace(i,void 0,{shallow:!0})}(e)}})}),(0,i.jsx)(eb,{index:2,currentStep:B,title:"Preview",disabled:ei,inActiveNode:(0,i.jsxs)(s.k,{gap:2,height:"40px",alignItems:"center",children:[et&&ec.length>0?eM?(0,i.jsx)(er,{templateId:et.id,imageId:null!==(d=null==ec?void 0:null===(t=ec[0])||void 0===t?void 0:t.imageId)&&void 0!==d?d:"",placeholderCanvasSize:{width:40*et.aspectRatio,height:40},...ek}):ec.map((e,t)=>e&&e.imageId&&(0,i.jsx)(er,{templateId:et.id,imageId:null==e?void 0:e.imageId,placeholderCanvasSize:{width:40*et.aspectRatio,height:40},...ek},t)):eO.map((e,t)=>e.design?(0,i.jsx)(f.E,{height:"40px",alt:"",src:e.design,...ek},t):(0,i.jsx)(j.O,{...(0,M.Z)({width:40*(null!==(v=null==et?void 0:et.aspectRatio)&&void 0!==v?v:1),height:40})},t)),e_-5>0&&(0,i.jsx)(s.k,{width:"40px",height:"40px",justifyContent:"center",alignItems:"center",bgColor:"#F7F7F7",children:(0,i.jsxs)(u.x,{fontSize:"sm",children:["+",e_-eO.length]})})]}),children:2===B&&et&&eW&&(0,i.jsx)(Y,{uploads:ec,selectedTemplate:et,numberOfRemainingImages:G.length-5,thumbnailSize:eW})})]}),eR[B]&&B<eR.length&&(0,i.jsx)(s.k,{justifyContent:"center",children:(0,i.jsx)(g.z,{_hover:{textDecoration:"none"},_disabled:{background:"gray.200"},disabled:eR[B].disabled,px:6,py:2,mb:6,rounded:5,textAlign:"center",bg:"palette.2",color:"white",fontSize:"sm",fontWeight:"bold",onClick:()=>(function(e){let t=B+1;L(t),q([...H,t]),e()})(eR[B].onClick),children:eR[B].text})}),_&&(0,i.jsx)(s.k,{justifyContent:"center",children:_}),ei&&(!F||"processed"!==F.state)&&(0,i.jsxs)(P,{mb:6,children:[(0,i.jsx)(I.qf,{options:eF,width:125,height:125}),F&&"pending"===F.state&&(0,i.jsx)(X,{step:1,progress:es,action:"Uploading"}),F&&"processing"===F.state&&(0,i.jsx)(X,{step:2,progress:F.taskCount&&F.finishedTaskCount?Math.round(F.finishedTaskCount/F.taskCount*100):0,action:"Processing"}),F&&"pending"===F.state&&(0,i.jsx)(u.x,{fontSize:"sm",children:"Don't close the window during upload!"})]}),F&&"processed"===F.state&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(P,{mb:6,children:(0,i.jsx)(Z,{batch:F})}),(0,i.jsxs)(s.k,{justifyContent:"center",gap:8,children:[(0,i.jsx)(I.Qj,{href:"/batch",inverted:!0,children:"All Downloads"}),(0,i.jsx)(g.z,{_hover:{textDecoration:"none",bg:eS?"white":"palette.2",color:eS?"palette.2":"white"},px:6,py:2,rounded:5,textAlign:"center",bg:"white",color:"palette.2",fontSize:"sm",fontWeight:"bold",borderWidth:"1px",borderColor:"palette.2",onClick:eP,disabled:eS,children:"Start new Batch"})]})]})]})]})};var ev=ey;let ek=n(3284),eS=[{text:"Batch Editor",link:"/batch",styles:{fontWeight:"bold"}}],eC=e=>{var t;let{initialBatches:n}=e,[a,r]=(0,l.useState)(n),d=(0,l.useRef)(!0),x=(0,l.useRef)(new Map),[g,m]=(0,l.useState)(),f=(0,c.S)({base:!0,md:!1}),j=(0,l.useMemo)(()=>null!==(t=a.find(e=>"processing"===e.state))&&void 0!==t?t:null,[a]),b=(0,l.useMemo)(()=>a.filter(e=>("processed"===e.state||"failed"===e.state)&&!e.archivedAt),[a]),w=(0,l.useCallback)((e,t)=>{x.current.set(e,t);let n=Math.max(...Array.from(x.current.values()));m(n)},[]);return(0,l.useEffect)(()=>((function(){let e=async()=>{let e=await (0,D.nO)().get("/api/batches"),t=e.data.data.batches;d.current&&r(t)};ek(e,()=>!d.current,2500,1/0)})(),()=>{d.current=!1}),[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.xu,{display:{base:"none",md:"block"},pt:"100px",pl:"40px",children:(0,i.jsx)(eh,{items:eS})}),(0,i.jsxs)(p.W,{maxW:"990px",pt:{base:"92px",md:"calc(172px - 115px)"},px:0,mb:8,children:[(0,i.jsxs)(s.k,{flexDir:"column",alignItems:"center",gap:4,mb:8,children:[(0,i.jsx)(I.Qj,{href:"/batch/new",disabled:Boolean(j),children:"Start new Batch"}),j&&(0,i.jsx)(u.x,{fontSize:{base:"x-small",md:"xs"},children:"You can start a new batch after the current one is finished."})]}),(0,i.jsxs)(s.k,{flexDir:"column",gap:8,children:[j&&(0,i.jsxs)(s.k,{flexDir:"column",gap:2,children:[(0,i.jsxs)(s.k,{mx:{base:4,lg:0},gap:2,children:[(0,i.jsx)(o.X,{as:"h3",fontSize:"md",children:"Currently Processing"}),(0,i.jsx)(N.$,{size:"sm",speed:"0.8s",emptyColor:"gray.200",thickness:"2px"})]}),(0,i.jsx)(s.k,{flexDir:"column",gap:6,children:(0,i.jsx)(U,{batch:j,thumbnailContainerWidth:g,isMobile:null!=f&&f,onThumbnailWidthChange:w})})]}),(0,i.jsxs)(s.k,{flexDir:"column",gap:2,children:[(0,i.jsx)(o.X,{as:"h3",fontSize:"md",mx:{base:4,lg:0},children:"Finished batches"}),(0,i.jsx)(s.k,{flexDir:"column",gap:6,children:b.map(e=>(0,i.jsx)(U,{batch:e,thumbnailContainerWidth:g,isMobile:null!=f&&f,onThumbnailWidthChange:w},e.id))}),0===b.length&&(0,i.jsx)(u.x,{fontSize:"xs",children:"You don't have any batches yet."})]})]})]})]})};var ez=eC,eI=n(3440),eE=n(13801),eM=n(73871),eD=n(73868);let eW=()=>{var e,t,n;let{data:a}=(0,eD.useSession)(),r=(null==a?void 0:null===(e=a.user)||void 0===e?void 0:null===(t=e.subscriptions)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.active)||!1,[d,c]=(0,l.useState)(!1);return(0,i.jsxs)(p.W,{maxW:"990px",pt:"172px",children:[(0,i.jsx)(s.k,{justifyContent:"center",children:(0,i.jsxs)(s.k,{justifyContent:"center",maxWidth:"620px",wrap:"wrap",children:[(0,i.jsx)(s.k,{direction:"column",w:{base:"100%",md:"33%"},children:(0,i.jsxs)(eI.r,{pos:"relative",templateColumns:"repeat(6, 1fr)",templateRows:"repeat(6, 1fr)",children:[(0,i.jsx)(eE.P,{zIndex:"1",colStart:1,colEnd:5,rowStart:3,rowEnd:7,children:(0,i.jsx)(eM.E,{src:"start/automation/original_1.png"})}),(0,i.jsx)(eE.P,{zIndex:"2",colStart:2,colEnd:6,rowStart:2,rowEnd:6,children:(0,i.jsx)(eM.E,{src:"start/automation/original_2.png"})}),(0,i.jsx)(eE.P,{zIndex:"3",colStart:3,colEnd:7,rowStart:1,rowEnd:5,children:(0,i.jsx)(eM.E,{src:"start/automation/original_3.png"})})]})}),(0,i.jsxs)(eI.r,{display:{base:"none",md:"grid"},w:"33%",pos:"relative",templateColumns:"repeat(7, 1fr)",templateRows:"repeat(7, 1fr)",children:[(0,i.jsx)(eE.P,{zIndex:"1",colStart:2,colEnd:6,rowStart:5,rowEnd:5,children:(0,i.jsx)(eM.E,{src:"start/arrow.svg",htmlWidth:"98px"})}),(0,i.jsx)(eE.P,{zIndex:"2",colStart:3,colEnd:7,rowStart:4,rowEnd:4,children:(0,i.jsx)(eM.E,{src:"start/arrow.svg",htmlWidth:"98px"})}),(0,i.jsx)(eE.P,{zIndex:"3",colStart:4,colEnd:8,rowStart:3,rowEnd:3,children:(0,i.jsx)(eM.E,{src:"start/arrow.svg",htmlWidth:"98px"})})]}),(0,i.jsx)(s.k,{direction:"column",w:{base:"100%",md:"33%"},children:(0,i.jsxs)(eI.r,{pos:"relative",templateColumns:"repeat(6, 1fr)",templateRows:"repeat(6, 1fr)",children:[(0,i.jsx)(eE.P,{zIndex:"1",colStart:1,colEnd:5,rowStart:3,rowEnd:7,children:(0,i.jsx)(eM.E,{src:"start/automation/design_1.png"})}),(0,i.jsx)(eE.P,{zIndex:"2",colStart:2,colEnd:6,rowStart:2,rowEnd:6,children:(0,i.jsx)(eM.E,{src:"start/automation/design_2.png"})}),(0,i.jsx)(eE.P,{zIndex:"3",colStart:3,colEnd:7,rowStart:1,rowEnd:5,children:(0,i.jsx)(eM.E,{src:"start/automation/design_3.png"})})]})})]})}),(0,i.jsx)(s.k,{justifyContent:"center",mt:16,mb:12,children:(0,i.jsx)(o.X,{as:"h1",maxWidth:"620px",fontSize:64,textAlign:"center",children:"Process any number of images"})}),(0,i.jsx)(s.k,{justifyContent:"center",mb:12,children:r?(0,i.jsx)(I.Qj,{href:"/batch/new",children:"Start new Batch"}):(0,i.jsx)(g.z,{_hover:{bg:"palette.2",color:"white"},px:6,py:2,rounded:5,textAlign:"center",bg:"palette.2",color:"white",fontSize:"sm",fontWeight:"bold",borderWidth:"1px",borderColor:"palette.2",onClick:function(){c(!0)},children:"Start new Batch"})}),(0,i.jsx)(I.B8,{open:d,onClose:function(){c(!1)}})]})};var eR=eW}}]);